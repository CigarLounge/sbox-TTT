@namespace TTT.UI

@code
{
    private Panel RoleContainer { get; set; }
    private Label Role { get; set; }

    private Panel HealthContainer { get; set; }
    private Label Health { get; set; }

    public override void Tick()
    {
        if (Local.Pawn is not Player player)
            return;

        this.Enabled(player.CurrentPlayer.IsValid() && player.CurrentPlayer.IsAlive());
        if (!this.IsEnabled())
            return;

        var hasRole = player.CurrentPlayer.Role is not NoneRole;
        HealthContainer.SetClass("left-flat", hasRole);
        RoleContainer.Enabled(hasRole);

        if (hasRole)
        {
            RoleContainer.Style.BackgroundColor = player.CurrentPlayer.Role.Color;
            Role.Text = player.CurrentPlayer.Role.Title;
        }

        Health.Text = $"âœš {player.CurrentPlayer.Health.CeilToInt()}";
    }

    [GameEvent.Player.TookDamage]
    private void OnHit(Player player)
    {
        if (!this.IsEnabled())
            return;

        HealthContainer.AddClass("hit");
        Utils.DelayAction(0.2f, () => { HealthContainer.RemoveClass("hit"); });
    }
}

<root class="opacity-heavy text-shadow">
    <div @ref=RoleContainer class="role-container">
        <text @ref=Role />
    </div>

    <div @ref=HealthContainer class=" health-container background-color-gradient">
        <text @ref=Health />
    </div>
</root>

<style>
    PlayerInfo {
        position: absolute;
        bottom: 25px;
        left: 25px;

        .role-container {
            padding: 2px 15px;
            border-radius: 4 0 0 4;
            justify-content: center;
            font-size: 30px;
            font-weight: bold;
        }

        .health-container {
            width: 115px;
            padding: 2px 10px;
            border-radius: 4px;
            justify-content: center;
            font-size: 30px;
            font-weight: bold;

            &.hit {
                color: rgb(255, 189, 189);
            }

            &.left-flat {
                border-radius: 0 4 4 0;
            }
        }
    }
</style>